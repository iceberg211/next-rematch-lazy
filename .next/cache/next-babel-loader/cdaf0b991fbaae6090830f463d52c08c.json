{"ast":null,"code":"import _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _Array$isArray from \"@babel/runtime-corejs2/core-js/array/is-array\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nvar _jsxFileName = \"F:\\\\next\\\\with-rematch-app\\\\shared\\\\withRematch.js\";\n\n/* eslint-disable no-underscore-dangle */\nimport React from 'react';\nimport { Provider, connect } from 'react-redux';\nimport initializeStore from './store';\n\nvar checkServer = function checkServer() {\n  return Object.prototype.toString.call(global.process) === '[object process]';\n};\n\nvar __NEXT_REMATCH_STORE__ = '__NEXT_REMATCH_STORE__';\n\nvar getOrCreateStore = function getOrCreateStore(lazyModel, initialState) {\n  var isServer = checkServer();\n\n  if (isServer) {\n    return initializeStore(initialState, lazyModel);\n  } // Memoize store in global variable if client\n\n\n  if (!window[__NEXT_REMATCH_STORE__]) {\n    console.log(initialState, 'initialStateinitialState');\n    window[__NEXT_REMATCH_STORE__] = initializeStore(initialState, lazyModel);\n  }\n\n  return window[__NEXT_REMATCH_STORE__];\n};\n\nexport default (function () {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  return function (Component) {\n    var mapToPops = args[0],\n        mapDisToProps = args[1],\n        lazyModel = args.slice(2);\n    var ConnectedComponent = connect(mapToPops, mapDisToProps)(Component);\n    return (\n      /*#__PURE__*/\n      function (_React$Component) {\n        _inherits(ComWithRematch, _React$Component);\n\n        _createClass(ComWithRematch, null, [{\n          key: \"getInitialProps\",\n          value: function () {\n            var _getInitialProps = _asyncToGenerator(\n            /*#__PURE__*/\n            _regeneratorRuntime.mark(function _callee(appContext) {\n              var store, isServer, reduxState, appProps;\n              return _regeneratorRuntime.wrap(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      // Get or Create the store with `undefined` as initialState\n                      // This allows you to set a custom default initialState\n                      store = getOrCreateStore(lazyModel);\n                      isServer = checkServer();\n\n                      if (!isServer && _Array$isArray(lazyModel)) {\n                        reduxState = store.getState();\n                        lazyModel.forEach(function (item) {\n                          var name = item.name;\n                          if (reduxState[name] === undefined) store.model(item);\n                        });\n                      }\n\n                      appContext.store = store;\n                      appContext.isServer = isServer;\n                      appProps = {};\n\n                      if (!(typeof Component.getInitialProps === 'function')) {\n                        _context.next = 10;\n                        break;\n                      }\n\n                      _context.next = 9;\n                      return Component.getInitialProps(appContext);\n\n                    case 9:\n                      appProps = _context.sent;\n\n                    case 10:\n                      return _context.abrupt(\"return\", _objectSpread({}, appProps, {\n                        initialReduxState: store.getState()\n                      }));\n\n                    case 11:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, _callee);\n            }));\n\n            function getInitialProps(_x) {\n              return _getInitialProps.apply(this, arguments);\n            }\n\n            return getInitialProps;\n          }()\n        }]);\n\n        function ComWithRematch(props) {\n          var _this;\n\n          _classCallCheck(this, ComWithRematch);\n\n          _this = _possibleConstructorReturn(this, _getPrototypeOf(ComWithRematch).call(this, props));\n          _this.store = getOrCreateStore(lazyModel, props.initialReduxState);\n          console.log(_this.store.getState());\n          console.log(props);\n          return _this;\n        }\n\n        _createClass(ComWithRematch, [{\n          key: \"render\",\n          value: function render() {\n            var pageProps = this.props.pageProps;\n            return React.createElement(Provider, {\n              store: this.store,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 67\n              },\n              __self: this\n            }, React.createElement(ConnectedComponent, _extends({}, pageProps, {\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 68\n              },\n              __self: this\n            })));\n          }\n        }]);\n\n        return ComWithRematch;\n      }(React.Component)\n    );\n  };\n});","map":{"version":3,"sources":["F:\\next\\with-rematch-app\\shared\\withRematch.js"],"names":["React","Provider","connect","initializeStore","checkServer","Object","prototype","toString","call","global","process","__NEXT_REMATCH_STORE__","getOrCreateStore","lazyModel","initialState","isServer","window","console","log","args","Component","mapToPops","mapDisToProps","ConnectedComponent","appContext","store","reduxState","getState","forEach","item","name","undefined","model","appProps","getInitialProps","initialReduxState","props","pageProps"],"mappings":"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","sourcesContent":["/* eslint-disable no-underscore-dangle */\nimport React from 'react';\nimport { Provider, connect } from 'react-redux';\nimport initializeStore from './store';\n\nconst checkServer = () => Object.prototype.toString.call(global.process) === '[object process]';\n\nconst __NEXT_REMATCH_STORE__ = '__NEXT_REMATCH_STORE__';\n\nconst getOrCreateStore = (lazyModel, initialState) => {\n  const isServer = checkServer();\n  if (isServer) {\n    return initializeStore(initialState, lazyModel);\n  }\n\n  // Memoize store in global variable if client\n  if (!window[__NEXT_REMATCH_STORE__]) {\n    console.log(initialState, 'initialStateinitialState')\n    window[__NEXT_REMATCH_STORE__] = initializeStore(initialState, lazyModel);\n  }\n  return window[__NEXT_REMATCH_STORE__];\n};\n\n\nexport default (...args) => Component => {\n  const [mapToPops, mapDisToProps, ...lazyModel] = args;\n  const ConnectedComponent = connect(mapToPops, mapDisToProps)(Component);\n\n  return class ComWithRematch extends React.Component {\n    static async getInitialProps(appContext) {\n      // Get or Create the store with `undefined` as initialState\n      // This allows you to set a custom default initialState\n      const store = getOrCreateStore(lazyModel);\n      const isServer = checkServer();\n      if (!isServer && Array.isArray(lazyModel)) {\n        const reduxState = store.getState();\n        lazyModel.forEach(item => {\n          const { name } = item;\n          if (reduxState[name] === undefined) store.model(item);\n        });\n      }\n\n      appContext.store = store;\n      appContext.isServer = isServer;\n\n      let appProps = {};\n      if (typeof Component.getInitialProps === 'function') {\n        appProps = await Component.getInitialProps(appContext);\n      }\n      return {\n        ...appProps,\n        initialReduxState: store.getState()\n      };\n    }\n\n    constructor(props) {\n      super(props);\n      this.store = getOrCreateStore(lazyModel, props.initialReduxState);\n      console.log(this.store.getState());\n      console.log(props);\n    }\n\n    render() {\n      const { pageProps } = this.props;\n\n      return (\n        <Provider store={this.store}>\n          <ConnectedComponent {...pageProps} />\n        </Provider>\n      );\n    }\n  };\n};\n"]},"metadata":{},"sourceType":"module"}